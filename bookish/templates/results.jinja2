{% if not type_desc %}
    {% macro type_desc(hit) -%}
    {%- endmacro %}
{% endif %}

{% if not category_desc %}
    {% macro category_desc(catname) -%}
        {{ catname }}
    {% endmacro %}
{% endif %}

{% macro print_hit(hit, cls="") %}
     <div class="hit {{ cls }} {{ hit.status }}">
        <p class="label">
            <a class="label" href="{{ hit.path }}">
                {{ hit.title | escape }}
            </a>
            {% if hit.subject %}
                <small class="desc">in {{ hit.subject | escape }}</small>
            {% else %}
                <small class="desc">{{ type_desc(hit) }}</small>
            {% endif %}
        </p>
    </div>
{% endmacro %}

{% macro print_instant(hit, cls="instant") %}
    <div class="hit {{ cls }} {{ hit.status }}">
        <p class="label">
            <a class="label" href="{{ hit.path }}">{{ hit.title | escape }}</a>
            <small class="desc">{{ type_desc(hit) }}</small>
        </p>
        <div class="content">
            {{ render_instant(hit["instant_doc"]) }}
        </div>
    </div>
{% endmacro %}

{% macro print_hits(catname, hits, count) %}
    <div class="hits" data-name="{{ catname }}">
        {% for hit in hits %}
            {{ print_hit(hit) }}
        {% endfor %}
        {% if hits | length < count %}
            <div class="more hit">
                <p class="label">
                    <i class="fa fa-plus-circle"></i>
                    {{ count - hits | length }}
                    more in {{ category_desc(catname) }}
                </p>
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro print_section(catname, hits, count) %}
    <section class="search-category">
        <h2 class="category">
            {{ category_desc(catname) }}
            <small>{{ count }}</small>
        </h2>
        {{ print_hits(catname, hits, count) }}
    </section>
{% endmacro %}

<div class="results-inner" data-sequence="{{ sequence }}">
    {% if length %}
        <p class="stats">{{ length }} hits, {{ "%0.4f" | format(runtime) }}s</p>

        <div class="cat-list">
            <div class="cat all {{ 'this' if not category }}" data-name="">
                <i class="fa fa-globe fa-fw"></i>
                All <small>{{ length }}</small>
            </div>
            {% for catname, _, count in categories %}
                <div class="cat {{ 'this' if catname == category }}" data-name="{{ catname }}">
                    <i class="fa fa-folder{{ "-o" if catname != category }} fa-fw"></i>
                    {{ category_desc(catname) }}
                    {% if count > 1 %}<small>{{ count }}</small>{% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="hit-block">
            {% if not permanent %}
                <div class="hit findpage">
                    <p class="label">
                        <a class="label" href="/find?q={{ qstring | urlencode }}">Open on separate page</a>
                    </p>
                </div>
            {% endif %}

            {% if category %}
                <div class="hits">
                    <div class="hit more show-all">
                        <p class="label">
                            <i class="fa fa-plus-circle"></i>
                            Show all results
                        </p>
                    </div>
                </div>
            {% elif instants %}
                <div class="instants">
                    {% for instant in instants %}
                        {{ print_instant(instant) }}
                    {% endfor %}
                </div>
            {% endif %}

            {% for catname, hits, catcount in categories %}
                {% if not category or catname == category %}
                    {{ print_section(catname, hits, catcount) }}
                {% endif %}
            {% endfor %}
        </div>

    {% elif not qstring %}
        <div class="search-tip message row">
            <div class="col col_1_of_2">
                <p>Type search terms separated by spaces.</p>

                <p>By default the search matches <strong>all</strong> terms.
                Use <code>AND</code>, <code>OR</code>, and <code>NOT</code> to
                do boolean searches.</p>

                <p>Use quotation marks to search for a phrase, for example
                <code>"render quality"</code></p>
            </div>
            <div class="col col_1_of_2">
                <p>You can narrow your search using a <strong>shortcut</strong>:</p>
                <table class="shortcuts">
                    {% for scut in config.SHORTCUTS %}
                        <tr>
                            <td class="shortcut"><code>!{{ scut.shortcut }}</code></td>
                            <td class="desc">{{ scut.desc }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>

    {% else %}
        <div class="message">
        No results for <span class="qstring">{{ qstring | escape }}</span>
        </div>
    {% endif %}
</div>
